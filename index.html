<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CMC Vellore – Stall Grid Contest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ================== BASIC THEME ================== -->
  <style>
    :root{
      --cmc-blue:#0b3c6d;
      --cmc-gold:#c9a24d;
      --soft-white:#f7f9fc;
      --glass:rgba(255,255,255,0.12);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      background:linear-gradient(180deg,#0b3c6d 0%,#082a4e 100%);
      color:#fff;
      overflow-x:hidden;
    }

    h1,h2,h3{
      font-weight:600;
      letter-spacing:0.3px;
    }

    section{
      padding:80px 20px;
      max-width:1200px;
      margin:auto;
    }

    .center{text-align:center}

    /* ================== HERO ================== */
    .hero{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      background:
        radial-gradient(circle at top,rgba(255,255,255,0.08),transparent 60%);
    }

    .hero img{
      width:120px;
      margin-bottom:25px;
    }

    .hero h1{
      font-size:clamp(28px,5vw,48px);
      margin:0;
    }

    .hero p{
      max-width:700px;
      opacity:0.9;
      font-size:18px;
      margin-top:20px;
    }

    .scroll-hint{
      margin-top:60px;
      opacity:0.6;
      font-size:14px;
    }

    /* ================== GLASS CARD ================== */
    .glass{
      background:var(--glass);
      backdrop-filter:blur(14px);
      border:1px solid rgba(255,255,255,0.18);
      border-radius:18px;
      padding:40px;
      box-shadow:0 30px 60px rgba(0,0,0,0.25);
    }

    /* ================== PRAYER ================== */
    .prayer{
      font-style:italic;
      font-size:20px;
      line-height:1.7;
      color:#e8eef7;
    }

    .prayer small{
      display:block;
      margin-top:20px;
      opacity:0.8;
      font-style:normal;
    }

    /* ================== AUTH ================== */
    .auth-box{
      max-width:420px;
      margin:40px auto 0;
    }

    input{
      width:100%;
      padding:14px;
      margin-top:12px;
      border-radius:10px;
      border:none;
      outline:none;
      font-size:16px;
    }

    button{
      width:100%;
      margin-top:18px;
      padding:14px;
      border-radius:12px;
      border:none;
      background:linear-gradient(135deg,var(--cmc-gold),#e6c06b);
      font-weight:600;
      cursor:pointer;
    }

    button:hover{opacity:0.9}

    /* ================== STALL GRID ================== */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
      gap:18px;
      margin-top:40px;
    }

    .stall{
      background:rgba(255,255,255,0.15);
      border-radius:14px;
      padding:20px 10px;
      text-align:center;
      cursor:pointer;
      transition:0.3s;
    }

    .stall:hover{
      transform:translateY(-4px);
      background:rgba(255,255,255,0.25);
    }

    .stall.visited{
      background:linear-gradient(135deg,#4caf50,#2e7d32);
    }

    /* ================== FOOTER ================== */
    footer{
      padding:40px 20px;
      text-align:center;
      opacity:0.7;
      font-size:14px;
    }

    @media(max-width:600px){
      section{padding:60px 16px}
      .glass{padding:28px}
    }
  </style>
</head>
<body>

<!-- ================== HERO ================== -->
<div class="hero">
  <img src="assets/cmc.png" alt="CMC Logo">
  <h1>Welcome to the Stall Grid Contest at CMC Vellore</h1>
  <p>
    Explore every exhibitor, scan QR codes at each stall, and complete your
    digital passport to win exciting prizes.
  </p>
  <div class="scroll-hint">Scroll to begin ↓</div>
</div>

<!-- ================== PRAYER ================== -->
<section>
  <div class="glass center">
    <div class="prayer">
      “…not to be ministered unto, but to minister.”
      <small>— Matthew 20:28</small>
      <br><br>
      Inspired by Ida S. Scudder’s faith and vision, CMC continues a legacy
      of compassionate service through excellence in healthcare and education.
    </div>
  </div>
</section>

<!-- ================== AUTH ================== -->
<section>
  <div class="glass auth-box">
    <h2 class="center">Participant Login</h2>
    <input id="name" placeholder="Full Name">
    <input id="email" placeholder="Email Address">
    <button onclick="signup()">Enter Contest</button>
    <p id="authMsg" style="margin-top:15px;text-align:center;opacity:0.8"></p>
  </div>
</section>

<!-- ================== STALL GRID ================== -->
<section id="contest" style="display:none">
  <div class="glass">
    <h2 class="center">Stall Grid</h2>
    <p class="center" style="opacity:0.85">
      Visit each stall and scan the QR code to collect your stamps.
    </p>

    <div class="grid" id="grid"></div>
  </div>
</section>

<footer>
  © CMC Vellore · IRIA Conference
</footer>

<!-- ================== SCRIPT ================== -->
<script>
  const API_BASE = "https://cmc-iria-secure.onrender.com";
  const TOTAL_STALLS = 12;

  const token = localStorage.getItem("token");

  if(token){
    document.getElementById("contest").style.display="block";
    loadPassport();
  }

  function signup(){
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    if(!name || !email){
      document.getElementById("authMsg").innerText="Please fill all fields";
      return;
    }

    fetch(API_BASE+"/api/signup",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({name,email})
    })
    .then(r=>r.json())
    .then(d=>{
      if(d.token){
        localStorage.setItem("token",d.token);
        document.getElementById("contest").style.display="block";
        loadPassport();
      }else{
        document.getElementById("authMsg").innerText="Login failed";
      }
    })
    .catch(()=>{
      document.getElementById("authMsg").innerText="Server error";
    });
  }

  function loadPassport(){
    const grid = document.getElementById("grid");
    grid.innerHTML="";

    fetch(API_BASE+"/api/passport",{
      headers:{Authorization:"Bearer "+localStorage.getItem("token")}
    })
    .then(r=>r.json())
    .then(data=>{
      for(let i=1;i<=TOTAL_STALLS;i++){
        const div=document.createElement("div");
        div.className="stall"+(data.visited?.includes(i)?" visited":"");
        div.innerText="Stall "+i;
        div.onclick=()=>scan(i);
        grid.appendChild(div);
      }
    });
  }

  function scan(id){
    fetch(API_BASE+"/api/scan",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        Authorization:"Bearer "+localStorage.getItem("token")
      },
      body:JSON.stringify({stallId:id})
    })
    .then(()=>loadPassport());
  }
</script>

</body>
</html>
